{"version":3,"sources":["emails-input.js"],"names":["getRandomEmail","user","Math","random","toString","substring","floor","EmailsInput","inputContainerNode","options","_getInputArea","console","error","_BLOCKNAME","_ADD_MORE_PEOPLE_TEXT","textAddMore","_emailsList","_onChange","onChange","callback","_buildInputArea","prototype","_validateEmail","email","re","test","String","toLowerCase","_addMoreEmailsAppend","inputArea","el","document","createElement","className","innerHTML","onclick","showUserInput","appendChild","scrollTop","scrollHeight","clientHeight","_addMoreEmailsRemove","querySelector","parentElement","removeChild","forEach","element","_renderNewEmail","newInputAreaItem","newInputAreaText","innerText","newInputAreaClose","_removeItemByEmail","idx","indexOf","_removeItemByIndex","emailToRemove","splice","itemToRemove","querySelectorAll","action","items","newItems","_onUserInputBlur","event","userInput","target","value","addOneEmail","_userInputRemove","addEmails","emails","i","length","push","addRandomEmail","getEmails","result","item","setEmails","showEmailsCount","validEmailsCount","alert","onblur","bind","onkeyup","keyCode","replace","pop","onpaste","setTimeout","split","focus"],"mappings":"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","file":"emails-input.5b64781c.js","sourceRoot":"..","sourcesContent":["\"use strict\";\r\n\r\nfunction getRandomEmail() {\r\n\tconst user = Math.random().toString(36).substring(2, 6);\r\n\tconst domains = ['gmail.com', 'miro.com', 'mail.ru', 'ya.ru', 'icloud.com'];\r\n\r\n\treturn user + '@' + domains[Math.floor(Math.random() * 5)];\r\n}\r\n\r\nfunction EmailsInput(inputContainerNode, options) {\r\n\tthis._getInputArea = function () {\r\n\t\tif (!inputContainerNode) {\r\n\t\t\t//todo: check options format\r\n\t\t\tconsole.error('inputContainerNode is not a node');\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn inputContainerNode\r\n\t}\r\n\r\n\tthis._BLOCKNAME = 'EmailsInput';\r\n\r\n\t//default options\t\r\n\tthis._ADD_MORE_PEOPLE_TEXT = 'add more people...';\r\n\t//set options from object\r\n\tif (options) {\r\n\t\tif (options.textAddMore) {\r\n\t\t\tthis._ADD_MORE_PEOPLE_TEXT = options.textAddMore;\r\n\t\t}\r\n\t}\r\n\r\n\tthis._emailsList = ['test@gmail.com', getRandomEmail(), getRandomEmail(), getRandomEmail()];\r\n\r\n\tthis._onChange = function () {\r\n\t\t//default onchange\r\n\t}\r\n\r\n\tthis.onChange = function (callback) {\r\n\t\tthis._onChange = callback;\r\n\t}\r\n\r\n\tthis._buildInputArea();\r\n}\r\n\r\nEmailsInput.prototype._validateEmail = function (email) {\r\n\tvar re = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n\treturn re.test(String(email).toLowerCase());\r\n}\r\n\r\nEmailsInput.prototype._addMoreEmailsAppend = function () {\r\n\tconst inputArea = this._getInputArea();\r\n\tconst el = document.createElement('span');\r\n\tel.className = this._BLOCKNAME + '__AddMoreEmails';\r\n\tel.innerHTML = this._ADD_MORE_PEOPLE_TEXT;\r\n\tel.onclick = () => { this.showUserInput(); }\r\n\t//el.onclick = function () { this.showUserInput(); }.bind(this); //ie\r\n\tinputArea.appendChild(el);\r\n\tinputArea.scrollTop = inputArea.scrollHeight - inputArea.clientHeight; //autoscroll to bottom\r\n}\r\n\r\nEmailsInput.prototype._addMoreEmailsRemove = function () {\r\n\tconst el = this._getInputArea().querySelector('.' + this._BLOCKNAME + '__AddMoreEmails');\t\r\n\tif (el) {\r\n\t\tel.onclick = null; //prevent leak\r\n\t\tel.parentElement.removeChild(el);\t\t\r\n\t}\r\n}\r\n\r\nEmailsInput.prototype._buildInputArea = function () {\r\n\tconst inputArea = this._getInputArea();\r\n\tinputArea.innerHTML = '';\r\n\tthis._emailsList.forEach(element => {\r\n\t\tthis._renderNewEmail(element);\r\n\t});\r\n\tthis._addMoreEmailsAppend();\r\n};\r\n\r\nEmailsInput.prototype._renderNewEmail = function (email) {\r\n\tconst inputArea = this._getInputArea();\r\n\r\n\tconst newInputAreaItem = document.createElement('span');\r\n\tnewInputAreaItem.className = this._BLOCKNAME + \"__Item\";\r\n\tif (!this._validateEmail(email)) {\r\n\t\tnewInputAreaItem.className = newInputAreaItem.className + ' EmailsInput__Item-invalid';\r\n\t}\r\n\tconst newInputAreaText = document.createElement('span');\r\n\tnewInputAreaText.className = this._BLOCKNAME + '__ItemText';\r\n\tnewInputAreaText.innerText = email;\r\n\tconst newInputAreaClose = document.createElement('span');\r\n\tnewInputAreaClose.className = this._BLOCKNAME + '__ItemClose';\r\n\tnewInputAreaClose.onclick = () => { this._removeItemByEmail(email); }\r\n\tnewInputAreaItem.appendChild(newInputAreaText);\r\n\tnewInputAreaItem.appendChild(newInputAreaClose);\r\n\r\n\tinputArea.appendChild(newInputAreaItem);\r\n}\r\n\r\nEmailsInput.prototype._removeItemByEmail = function (email) {\r\n\tconst idx = this._emailsList.indexOf(email);\r\n\tthis._removeItemByIndex(idx);\r\n}\r\n\r\nEmailsInput.prototype._removeItemByIndex = function (idx) {\r\n\tconst emailToRemove = this._emailsList[idx];\r\n\tthis._emailsList.splice(idx, 1);\r\n\tconst inputArea = this._getInputArea();\r\n\tlet itemToRemove = inputArea.querySelectorAll('.' + this._BLOCKNAME + '__Item')[idx];\r\n\tinputArea.removeChild(itemToRemove);\r\n\tthis._onChange({ action: 'delete', items: emailToRemove, newItems: this._emailsList });\r\n}\r\n\r\nEmailsInput.prototype._onUserInputBlur = function (event) {\r\n\tconst userInput = event.target;\r\n\tif (userInput.value !== '') {\r\n\t\tthis.addOneEmail(userInput.value);\r\n\t} else {\r\n\t\tthis._addMoreEmailsAppend();\r\n\t}\r\n\tthis._userInputRemove();\r\n};\r\n\r\nEmailsInput.prototype._userInputRemove = function () {\r\n\tconst el = this._getInputArea().querySelector('.' + this._BLOCKNAME + '__UserInput');\r\n\tif (el) {\r\n\t\tel.parentElement.removeChild(el);\r\n\t}\r\n}\r\n\r\nEmailsInput.prototype.addEmails = function (emails) {\r\n\tthis._addMoreEmailsRemove();\r\n\tfor (let i = 0; i < emails.length; i++) {\r\n\t\tthis._renderNewEmail(emails[i]);\r\n\t\tthis._emailsList.push(emails[i]);\r\n\t}\r\n\tthis._onChange({ action: 'add', items: emails, newItems: this._emailsList });\r\n\tthis._addMoreEmailsAppend();\r\n}\r\n\r\nEmailsInput.prototype.addOneEmail = function (email) {\r\n\tthis._addMoreEmailsRemove();\r\n\tthis._renderNewEmail(email);\r\n\tthis._emailsList.push(email);\r\n\tthis._onChange({ action: 'add', items: email, newItems: this._emailsList });\r\n\tthis._addMoreEmailsAppend();\r\n}\r\n\r\nEmailsInput.prototype.addRandomEmail = function () {\r\n\tthis.addOneEmail(getRandomEmail());\r\n}\r\n\r\nEmailsInput.prototype.getEmails = function () {\r\n\tconst result = []; //prevent edit\r\n\tthis._emailsList.forEach((item) => { result.push(item); }); //Object.assign is not supported in IE, polyfills are forbidden by conditions of the task\r\n\treturn result;\r\n}\r\n\r\nEmailsInput.prototype.setEmails = function (emails) { //TODO: check correct of array\r\n\tthis._emailsList = emails;\r\n\tthis._buildInputArea();\r\n}\r\n\r\nEmailsInput.prototype.showEmailsCount = function () {\r\n\tlet validEmailsCount = 0;\r\n\tfor (let i = 0; i < this._emailsList.length; i++) {\r\n\t\tif (this._validateEmail(this._emailsList[i])) {\r\n\t\t\tvalidEmailsCount = validEmailsCount + 1;\r\n\t\t}\r\n\t}\r\n\talert(validEmailsCount);//custom alert can be added here\r\n}\r\n\r\nEmailsInput.prototype.showUserInput = function () {\r\n\tthis._addMoreEmailsRemove();\r\n\tconst inputArea = this._getInputArea();\r\n\r\n\tconst userInput = document.createElement('input');\r\n\tuserInput.className = this._BLOCKNAME + \"__UserInput\"\r\n\tinputArea.appendChild(userInput);\r\n\r\n\tuserInput.onblur = this._onUserInputBlur.bind(this);\r\n\r\n\tuserInput.onkeyup = (event) => {\r\n\t\tif (event.keyCode === 188) {//comma\r\n\t\t\tif (userInput.value.replace(',', '') !== '') {\r\n\t\t\t\tuserInput.value = userInput.value.replace(',', '');\r\n\t\t\t\tif (userInput.value !== '') {\r\n\t\t\t\t\tthis.addOneEmail(userInput.value);\r\n\t\t\t\t}\r\n\t\t\t\tuserInput.onblur = function () { };\r\n\t\t\t\tthis._userInputRemove();\r\n\t\t\t\tthis.showUserInput();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (event.keyCode === 13) {//enter\r\n\t\t\tif (userInput.value !== '') {\r\n\t\t\t\tthis.addOneEmail(userInput.value);\r\n\t\t\t\tuserInput.onblur = function () { };\r\n\t\t\t\tthis._userInputRemove();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (event.keyCode === 8) {//backspace\r\n\t\t\tif (userInput.value === '') {\r\n\t\t\t\tconst inputArea = this._getInputArea();\r\n\t\t\t\tconst items = inputArea.querySelectorAll('.' + this._BLOCKNAME + '__Item');\r\n\t\t\t\tif (items.length) {\r\n\t\t\t\t\tinputArea.removeChild(items[items.length - 1]);\r\n\t\t\t\t\tthis._emailsList.pop();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tuserInput.onpaste = (event) => {\r\n\t\tsetTimeout(() => {\r\n\t\t\tif (userInput.value !== '') {\r\n\t\t\t\tif (userInput.value !== '') {\r\n\t\t\t\t\tconst emails = userInput.value.split(',');\r\n\t\t\t\t\tthis.addEmails(emails);\r\n\t\t\t\t}\r\n\t\t\t\tuserInput.onblur = function () { };\r\n\t\t\t\t//userInput.removeEventListener('blur', this._onUserInputBlur);\r\n\t\t\t\tthis._userInputRemove();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tuserInput.focus();\r\n}"]}