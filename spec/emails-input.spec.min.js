"use strict";var domNodeId="firstEmailInput";var firstEM=new EmailsInput(document.querySelector("#"+domNodeId),{textAddMore:"custom text from options..."});runTests(firstEM,domNodeId);domNodeId="secondEmailInput";var secondEM=new EmailsInput(document.querySelector("#"+domNodeId));runTests(secondEM,domNodeId);function runTests(EM,domNodeId){var testEmail="firsttest@gmail.com";var testEmails="many1@omg.com,many2@sts.com,many3@sts.com";var lastEvent={};EM.onChange(function(e){lastEvent=e});describe(domNodeId+" API tests",function(){it("set and get Emails",function(){var testList=["test@gmail.com",getRandomEmail(),getRandomEmail()];EM.setEmails(testList);expect(EM.getEmails()).toEqual(testList)})});describe(domNodeId+" Emails Input Basic tests",function(){it("validate email",function(){expect(EM._validateEmail("111")).toBe(false);expect(EM._validateEmail("111.")).toBe(false);expect(EM._validateEmail("11a.bbb")).toBe(false);expect(EM._validateEmail("111@test.com")).toBe(true);expect(EM._validateEmail("111abc@test.xyz.com")).toBe(true)});it("add item: check DOM, get API and subscribe",function(){var beforeAddCount=EM._emailsList.length;EM.addOneEmail(testEmail);var domItem=document.querySelectorAll("#"+domNodeId+" .EmailsInput__Item")[EM._emailsList.length-1];var testItem=document.createElement("span");testItem.className="EmailsInput__Item";var testItemText=document.createElement("span");testItemText.className="EmailsInput__ItemText";testItemText.innerText=testEmail;var testItemClose=document.createElement("span");testItemClose.className="EmailsInput__ItemClose";testItem.appendChild(testItemText);testItem.appendChild(testItemClose);expect(domItem).toEqual(testItem);expect(EM._emailsList.length).toBe(beforeAddCount+1);expect(lastEvent).toEqual({action:"add",items:testEmail,newItems:EM.getEmails()})});it("remove item: check DOM, get API and subscribe",function(){var beforeRemoveCount=EM._emailsList.length;var beforeRemoveDomItemsCount=document.querySelectorAll("#"+domNodeId+" .EmailsInput__Item").length;EM._removeItemByEmail(testEmail);expect(EM._emailsList.length).toBe(beforeRemoveCount-1);expect(document.querySelectorAll("#"+domNodeId+" .EmailsInput__Item").length).toBe(beforeRemoveDomItemsCount-1);expect(lastEvent).toEqual({action:"delete",items:testEmail,newItems:EM.getEmails()})});it("show userInput after click \"add more people\"",function(){var userInput=document.createElement("input");userInput.className=EM._BLOCKNAME+"__UserInput";document.querySelector("#"+domNodeId+" .EmailsInput__AddMoreEmails").click();var domUserInput=document.querySelector("#"+domNodeId+" .EmailsInput__UserInput");expect(domUserInput).toEqual(userInput)});it("userInput should be active",function(){var domUserInput=document.querySelector("#"+domNodeId+" .EmailsInput__UserInput");expect(domUserInput).toEqual(document.activeElement)});it("add item from input after blur",function(){var beforeAddCount=EM._emailsList.length;var domUserInput=document.querySelector("#"+domNodeId+" .EmailsInput__UserInput");domUserInput.value="test123@omg.com";domUserInput.blur();if(~window.navigator.userAgent.indexOf("Trident")){return}expect(EM._emailsList.length).toBe(beforeAddCount+1)})});describe(domNodeId+" Emails Input Paste 3 emails",function(){beforeEach(function(){jasmine.clock().install();var userInput=document.createElement("input");userInput.className=EM._BLOCKNAME+"__UserInput";document.querySelector("#"+domNodeId+" .EmailsInput__AddMoreEmails").click();var domUserInput=document.querySelector("#"+domNodeId+" .EmailsInput__UserInput");domUserInput.value=testEmails;domUserInput.onpaste()});afterEach(function(){jasmine.clock().uninstall()});it("show add many emails from user input immediately",function(){var beforeAddCount=EM._emailsList.length;jasmine.clock().tick(1000);expect(EM._emailsList.length).toBe(beforeAddCount+3);expect(lastEvent).toEqual({action:"add",items:testEmails.split(","),newItems:EM.getEmails()})})});describe(domNodeId+" Emails Input KeyUp Enter",function(){var beforeAddCount;beforeEach(function(){jasmine.clock().install();document.querySelector("#"+domNodeId+" .EmailsInput__AddMoreEmails").click();var domUserInput=document.querySelector("#"+domNodeId+" .EmailsInput__UserInput");domUserInput.value="test555@super.com";beforeAddCount=EM._emailsList.length;domUserInput.onkeyup({keyCode:13})});afterEach(function(){jasmine.clock().uninstall()});it("add item from input after pressing Enter",function(){jasmine.clock().tick(1000);expect(EM._emailsList.length).toBe(beforeAddCount+1)})});describe(domNodeId+" Emails Input KeyUp Comma",function(){var beforeAddCount;beforeEach(function(){jasmine.clock().install();document.querySelector("#"+domNodeId+" .EmailsInput__AddMoreEmails").click();var domUserInput=document.querySelector("#"+domNodeId+" .EmailsInput__UserInput");domUserInput.value="comma@super.com";beforeAddCount=EM._emailsList.length;domUserInput.onkeyup({keyCode:188})});afterEach(function(){jasmine.clock().uninstall()});it("add item from input after pressing comma and userInput should be active",function(){jasmine.clock().tick(1000);expect(EM._emailsList.length).toBe(beforeAddCount+1);var domUserInput=document.querySelector("#"+domNodeId+" .EmailsInput__UserInput");expect(domUserInput).toEqual(document.activeElement)})});describe(domNodeId+"Emails Input KeyUp Backspace",function(){var beforeRemoveCount;beforeEach(function(){jasmine.clock().install();beforeRemoveCount=EM._emailsList.length;var domUserInput=document.querySelector("#"+domNodeId+" .EmailsInput__UserInput");domUserInput.onkeyup({keyCode:8})});afterEach(function(){jasmine.clock().uninstall()});it("remove item pressing backspace and userInput should be active",function(){jasmine.clock().tick(1000);expect(EM._emailsList.length).toBe(beforeRemoveCount-1);var domUserInput=document.querySelector("#"+domNodeId+" .EmailsInput__UserInput");expect(domUserInput).toEqual(document.activeElement)})})}
