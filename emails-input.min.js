"use strict";function getRandomEmail(){var user=Math.random().toString(36).substring(2,6);var domains=["gmail.com","miro.com","mail.ru","ya.ru","icloud.com"];return user+"@"+domains[Math.floor(Math.random()*5)]}function EmailsInput(inputContainerNode,options){var _this=this;this._getInputArea=function(){if(!inputContainerNode){console.error("inputContainerNode is not a node");return false}return inputContainerNode};this._BLOCKNAME="EmailsInput";this._ADD_MORE_PEOPLE_TEXT="add more people...";if(options){if(options.textAddMore){this._ADD_MORE_PEOPLE_TEXT=options.textAddMore}}this._emailsList=[];this._onChange=function(){};this.onChange=function(callback){this._onChange=callback};this._buildInputArea();this._getInputArea().onclick=function(event){if(event.target===_this._getInputArea()){_this.showUserInput()}}}EmailsInput.prototype._validateEmail=function(email){var re=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return re.test(String(email).toLowerCase())};EmailsInput.prototype._addMoreEmailsAppend=function(){var _this2=this;var inputArea=this._getInputArea();var el=document.createElement("span");el.className=this._BLOCKNAME+"__AddMoreEmails";el.innerHTML=this._ADD_MORE_PEOPLE_TEXT;el.onclick=function(){_this2.showUserInput()};inputArea.appendChild(el);inputArea.scrollTop=inputArea.scrollHeight-inputArea.clientHeight};EmailsInput.prototype._addMoreEmailsRemove=function(){var el=this._getInputArea().querySelector("."+this._BLOCKNAME+"__AddMoreEmails");if(el){el.onclick=null;el.parentElement.removeChild(el)}};EmailsInput.prototype._buildInputArea=function(){var _this3=this;var inputArea=this._getInputArea();inputArea.innerHTML="";this._emailsList.forEach(function(element){_this3._renderNewEmail(element)});this._addMoreEmailsAppend()};EmailsInput.prototype._renderNewEmail=function(email){var _this4=this;var inputArea=this._getInputArea();var newInputAreaItem=document.createElement("span");newInputAreaItem.className=this._BLOCKNAME+"__Item";if(!this._validateEmail(email)){newInputAreaItem.className=newInputAreaItem.className+" EmailsInput__Item-invalid"}var newInputAreaText=document.createElement("span");newInputAreaText.className=this._BLOCKNAME+"__ItemText";newInputAreaText.innerText=email;var newInputAreaClose=document.createElement("span");newInputAreaClose.className=this._BLOCKNAME+"__ItemClose";newInputAreaClose.onclick=function(){_this4._removeItemByEmail(email)};newInputAreaItem.appendChild(newInputAreaText);newInputAreaItem.appendChild(newInputAreaClose);inputArea.appendChild(newInputAreaItem)};EmailsInput.prototype._removeItemByEmail=function(email){var idx=this._emailsList.indexOf(email);this._removeItemByIndex(idx)};EmailsInput.prototype._removeItemByIndex=function(idx){var emailToRemove=this._emailsList[idx];this._emailsList.splice(idx,1);var inputArea=this._getInputArea();var itemToRemove=inputArea.querySelectorAll("."+this._BLOCKNAME+"__Item")[idx];inputArea.removeChild(itemToRemove);this._onChange({action:"delete",items:emailToRemove,newItems:this._emailsList})};EmailsInput.prototype._onUserInputBlur=function(event){var userInput=event.target;if(userInput.value!==""){this.addOneEmail(userInput.value)}else{this._addMoreEmailsAppend()}this._userInputRemove()};EmailsInput.prototype._userInputRemove=function(){var el=this._getInputArea().querySelector("."+this._BLOCKNAME+"__UserInput");if(el){el.parentElement.removeChild(el)}};EmailsInput.prototype.addEmails=function(emails){this._addMoreEmailsRemove();for(var i=0;i<emails.length;i++){this._renderNewEmail(emails[i]);this._emailsList.push(emails[i])}this._onChange({action:"add",items:emails,newItems:this._emailsList});this._addMoreEmailsAppend()};EmailsInput.prototype.addOneEmail=function(email){email=email.replace(" ","");this._addMoreEmailsRemove();this._renderNewEmail(email);this._emailsList.push(email);this._onChange({action:"add",items:email,newItems:this._emailsList});this._addMoreEmailsAppend()};EmailsInput.prototype.addRandomEmail=function(){this.addOneEmail(getRandomEmail())};EmailsInput.prototype.getEmails=function(){var result=[];this._emailsList.forEach(function(item){result.push(item)});return result};EmailsInput.prototype.setEmails=function(emails){this._emailsList=emails;this._buildInputArea()};EmailsInput.prototype.showEmailsCount=function(){var validEmailsCount=0;for(var i=0;i<this._emailsList.length;i++){if(this._validateEmail(this._emailsList[i])){validEmailsCount=validEmailsCount+1}}alert(validEmailsCount)};EmailsInput.prototype.showUserInput=function(){var _this5=this;this._addMoreEmailsRemove();var inputArea=this._getInputArea();var userInput=document.createElement("input");userInput.className=this._BLOCKNAME+"__UserInput";inputArea.appendChild(userInput);userInput.onblur=this._onUserInputBlur.bind(this);userInput.onkeyup=function(event){if(event.keyCode===188||event.keyCode===32){if(userInput.value.replace(",","")!==""){userInput.value=userInput.value.replace(",","");if(userInput.value!==""){_this5.addOneEmail(userInput.value)}userInput.onblur=function(){};_this5._userInputRemove();_this5.showUserInput()}}if(event.keyCode===13){if(userInput.value!==""){_this5.addOneEmail(userInput.value);userInput.onblur=function(){};_this5._userInputRemove()}}if(event.keyCode===8){if(userInput.value===""){var _inputArea=_this5._getInputArea();var items=_inputArea.querySelectorAll("."+_this5._BLOCKNAME+"__Item");if(items.length){_inputArea.removeChild(items[items.length-1]);_this5._emailsList.pop()}}}};userInput.onpaste=function(event){setTimeout(function(){if(userInput.value!==""){if(userInput.value!==""){var emails=userInput.value.split(",");_this5.addEmails(emails)}userInput.onblur=function(){};_this5._userInputRemove()}})};userInput.focus()};
